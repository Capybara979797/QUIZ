<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Ghicește cuvântul</title>
  <style>
    :root{
      --bg1:#07150f; --bg2:#061a14;
      --stroke: rgba(255,255,255,.16);
      --text: rgba(255,255,255,.92);
      --accent:#6ee7b7;
      --bad:#fb7185; --good:#22c55e;
      --shadow: 0 20px 60px rgba(0,0,0,.55);
      --radius: 22px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    html{-webkit-text-size-adjust:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 30% 10%, rgba(110,231,183,.10), transparent 60%),
        radial-gradient(900px 700px at 85% 35%, rgba(52,211,153,.10), transparent 55%),
        linear-gradient(145deg, var(--bg1), var(--bg2));
      overflow:hidden; /* ținem fundalul fix; conținutul scrollează în card */
    }

    /* background canvas (optimized via JS) */
    #fx{position:absolute;inset:0;width:100%;height:100%;z-index:0;pointer-events:none}

    /* blobs */
    .blob{position:absolute;width:420px;height:420px;filter:blur(40px);opacity:.32;border-radius:999px;mix-blend-mode:screen;animation:drift 14s ease-in-out infinite;pointer-events:none}
    .b1{background:radial-gradient(circle at 30% 30%, rgba(110,231,183,.95), transparent 60%);top:-120px;left:-80px;animation-duration:16s}
    .b2{background:radial-gradient(circle at 60% 40%, rgba(52,211,153,.90), transparent 60%);bottom:-140px;right:-120px;animation-duration:18s}
    .b3{background:radial-gradient(circle at 40% 50%, rgba(251,191,36,.80), transparent 60%);top:45%;left:60%;width:340px;height:340px;opacity:.20;animation-duration:20s}
    @keyframes drift{0%{transform:translate3d(0,0,0) scale(1)}50%{transform:translate3d(40px,-30px,0) scale(1.06)}100%{transform:translate3d(0,0,0) scale(1)}}

    /* layout */
    .wrap{
      position:relative;
      z-index:2;
      min-height: 100svh;
      display:grid;
      place-items:center;
      padding:
        max(10px, env(safe-area-inset-top))
        max(10px, env(safe-area-inset-right))
        max(10px, env(safe-area-inset-bottom))
        max(10px, env(safe-area-inset-left));
    }

    .card{
      width: min(980px, calc(100vw - 20px));
      max-height: calc(100svh - 20px);
      border-radius:var(--radius);
      background:linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      box-shadow:var(--shadow);
      backdrop-filter:blur(14px);
      -webkit-backdrop-filter:blur(14px);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:14px 16px;
      border-bottom:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.10);
      flex:0 0 auto;
    }
    .left{display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:center}

    .badge{
      width:34px;height:34px;border-radius:12px;
      background:linear-gradient(135deg, rgba(110,231,183,.25), rgba(52,211,153,.18));
      border:1px solid rgba(255,255,255,.16);
      display:grid;place-items:center;box-shadow:0 10px 30px rgba(0,0,0,.25)
    }
    .pill{
      padding:7px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      display:flex;align-items:center;gap:8px;
      color: rgba(255,255,255,.82);
      font-size: 13px;
      white-space: nowrap;
    }
    .dot{width:8px;height:8px;border-radius:50%;background:var(--accent);box-shadow:0 0 0 6px rgba(110,231,183,.12)}
    .count{font-weight:800;letter-spacing:.3px;color:rgba(255,255,255,.92)}

    .main{
      padding:18px;
      transition: opacity .20s ease, transform .20s ease;
      will-change: opacity, transform;
      flex: 1 1 auto;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
    }
    .main.swap{opacity:0;transform: translateY(8px);}

    .slots{
      display:flex;flex-wrap:wrap;
      gap: 10px;
      padding: 10px 0 6px 0;
      min-height: 90px;
      align-items:center;
      justify-content:center;
    }

    .slot{
      width: clamp(38px, 10.5vw, 52px);
      height: clamp(48px, 12.5vw, 62px);
      border-radius: clamp(12px, 3.5vw, 16px);
      border:1px solid rgba(255,255,255,.14);
      background:linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      display:grid;place-items:center;position:relative;overflow:hidden;
      box-shadow:0 12px 26px rgba(0,0,0,.18);
      transform: translateY(0) scale(1);
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
      will-change: transform;
    }
    .slot::after{
      content:"";position:absolute;inset:-40% -40%;
      background:
        radial-gradient(circle at 30% 20%, rgba(110,231,183,.20), transparent 40%),
        radial-gradient(circle at 70% 60%, rgba(52,211,153,.16), transparent 42%);
      transform:rotate(18deg);opacity:.65;pointer-events:none;
    }
    .letter{
      font-size: clamp(18px, 5vw, 22px);
      font-weight:800;
      letter-spacing:.5px;
      position:relative;z-index:1;
      opacity:0;
      transform:translateY(10px) scale(.96);
      transition:opacity .18s ease, transform .18s cubic-bezier(.2,.9,.2,1);
    }
    .slot.revealed{
      transform: translateY(-2px) scale(1.02);
      border-color: rgba(110,231,183,.28);
      box-shadow: 0 16px 34px rgba(0,0,0,.24);
    }
    .slot.revealed .letter{opacity:1;transform:translateY(0) scale(1);}
    .underline{
      position:absolute;
      bottom: clamp(10px, 2.8vw, 14px);
      width: clamp(18px, 5vw, 22px);
      height:2px;
      background:rgba(255,255,255,.38);
      border-radius:999px;
      z-index:1
    }

    .controls{
      display:flex;flex-wrap:wrap;
      gap:10px;
      justify-content:center;
      margin-top: 12px;
    }
    button{
      appearance:none;border:none;cursor:pointer;border-radius:14px;
      padding: 11px 12px;
      color:rgba(255,255,255,.94);
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.16);
      transition:transform .12s ease, background .16s ease, border-color .16s ease;
      box-shadow:0 10px 22px rgba(0,0,0,.16);
      font-weight:800;
      letter-spacing:.2px;
      min-width: 130px;
      font-size: 14px;
    }
    button:active{transform:scale(.99)}
    .primary{background:linear-gradient(135deg, rgba(110,231,183,.22), rgba(52,211,153,.16));border-color:rgba(110,231,183,.30)}
    .danger{background:linear-gradient(135deg, rgba(251,113,133,.20), rgba(251,113,133,.10));border-color:rgba(251,113,133,.26)}
    .ghost{background:rgba(0,0,0,.12);border-color:rgba(255,255,255,.14)}

    .guessRow{
      display:flex;
      gap:10px;
      margin-top: 14px;
      justify-content:center;
      align-items:center;
      flex-wrap:wrap;
    }
    input{
      width:min(520px, 92vw);
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(0,0,0,.18);
      color:rgba(255,255,255,.92);
      outline:none;
      font-weight:800;
      letter-spacing:.3px;
      font-size: 14px;
    }
    .msg{
      margin-top: 10px;
      min-height: 22px;
      font-size: 14px;
      text-align:center;
      font-weight: 800;
      letter-spacing: .2px;
      color: rgba(255,255,255,.78);
    }
    .msg.good{ color: rgba(34,197,94,.95); }
    .msg.bad{ color: rgba(251,113,133,.95); }

    /* Confetti */
    .confetti{position:absolute;inset:0;pointer-events:none;z-index:3;overflow:hidden}
    .piece{position:absolute;width:10px;height:14px;border-radius:3px;opacity:.95;animation:fall 1.1s ease-in forwards}
    @keyframes fall{0%{transform:translateY(-20px) rotate(0deg);opacity:1}100%{transform:translateY(110vh) rotate(520deg);opacity:0}}

    /* === MOBILE: make it FULL + remove expensive blur === */
    @media (max-width: 520px){
      .card{
        width: calc(100vw - 14px);
        max-height: calc(100svh - 14px);
        border-radius: 18px;
        /* huge perf win on phone */
        backdrop-filter:none;
        -webkit-backdrop-filter:none;
        box-shadow: 0 14px 34px rgba(0,0,0,.38);
      }
      .topbar{
        flex-direction: column;
        justify-content:center;
        align-items:center;
        text-align:center;
        padding: 10px 12px;
        gap: 8px;
      }
      .badge{display:none;}
      .pill{font-size: 12px; padding: 6px 9px;}
      .main{padding: 12px;}
      .slots{gap: 8px; min-height: 80px;}
      .controls{gap: 8px;}
      button{
        min-width: unset;
        flex: 1 1 calc(50% - 8px);
        padding: 12px 10px;
        font-size: 13px;
      }
      input{width: 100%; flex: 1 1 100%;}
      #btnCheck{width: 100%; flex: 1 1 100%;}
      .blob{filter: blur(24px); opacity:.22; width:280px; height:280px;}
    }

    @media (max-width: 360px){
      button{flex: 1 1 100%;}
    }

    @media (prefers-reduced-motion: reduce){
      .blob{animation:none !important;}
      .slot,.letter,.main{transition:none !important;}
      #fx{display:none !important;}
    }
  </style>
</head>
<body>
  <canvas id="fx"></canvas>
  <div class="blob b1"></div><div class="blob b2"></div><div class="blob b3"></div>

  <div class="wrap">
    <div class="card">
      <div class="topbar">
        <div class="left">
          <div class="badge" aria-hidden="true">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M12 3c4 3 6 6 6 10a6 6 0 1 1-12 0c0-4 2-7 6-10Z" stroke="rgba(255,255,255,.9)" stroke-width="1.6"/>
              <path d="M10 14c2-1 4-3 5-6" stroke="rgba(255,255,255,.7)" stroke-width="1.6" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="pill"><span class="dot"></span> <span class="count" id="roundText">Runda 1/5</span></div>
        </div>
        <div class="pill"><span>Litere:</span> <span class="count" id="revealCount">0</span></div>
      </div>

      <div class="main" id="main">
        <div class="slots" id="slots"></div>

        <div class="controls">
          <button class="primary" id="btnRevealLetter">Literă</button>
          <button class="danger" id="btnRevealWord">Cuvânt</button>
          <button class="ghost" id="btnPrevWord">Înapoi</button>
          <button class="ghost" id="btnNextWord">Următorul</button>
          <button class="ghost" id="btnReset">Reset</button>
        </div>

        <div class="guessRow">
          <input id="guess" placeholder="Scrie răspunsul…" autocomplete="off" />
          <button class="primary" id="btnCheck">Verifică</button>
        </div>

        <div class="msg" id="msg"></div>
      </div>

      <div class="confetti" id="confetti"></div>
    </div>
  </div>

  <script>
    const WORDS = ["FOTOSINTEZĂ","GLUCOZĂ","CLOROFILĂ","STOMATE","POLENIZARE"];
    const AUTO_NEXT_ON_CORRECT = true;

    const $ = (id) => document.getElementById(id);

    function normalizeText(s){
      return (s || "")
        .toString()
        .trim()
        .toUpperCase()
        .normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    }

    let index = 0;
    let revealed = [];
    let revealedCount = 0;

    const mainEl = $("main");
    const slotsEl = $("slots");
    const msgEl = $("msg");
    const roundTextEl = $("roundText");
    const revealCountEl = $("revealCount");
    const guessEl = $("guess");
    const confettiEl = $("confetti");

    function renderSlots(word){
      slotsEl.innerHTML = "";
      [...word].forEach((ch) => {
        const slot = document.createElement("div");
        slot.className = "slot";

        const letter = document.createElement("div");
        letter.className = "letter";
        letter.textContent = ch;

        const underline = document.createElement("div");
        underline.className = "underline";

        slot.appendChild(letter);
        slot.appendChild(underline);
        slotsEl.appendChild(slot);
      });
    }

    function updateSlotReveal(){
      const slots = slotsEl.querySelectorAll(".slot");
      slots.forEach((slot, i) => slot.classList.toggle("revealed", !!revealed[i]));
      revealCountEl.textContent = String(revealedCount);
    }

    function setMsg(text, type){
      msgEl.className = "msg" + (type ? (" " + type) : "");
      msgEl.textContent = text || "";
    }

    function startRoundSmooth(){
      mainEl.classList.add("swap");
      setTimeout(() => {
        startRoundCore();
        mainEl.classList.remove("swap");
      }, 160);
    }

    function startRoundCore(){
      const word = WORDS[index];
      revealed = new Array([...word].length).fill(false);
      revealedCount = 0;
      roundTextEl.textContent = `Runda ${index + 1}/${WORDS.length}`;
      renderSlots(word);
      updateSlotReveal();
      guessEl.value = "";
      setMsg("", "");
    }

    function revealRandomLetter(){
      const letters = [...WORDS[index]];
      const hiddenIdx = [];
      for (let i = 0; i < letters.length; i++){
        if (letters[i] !== " " && !revealed[i]) hiddenIdx.push(i);
      }
      if (!hiddenIdx.length) return;

      const pick = hiddenIdx[Math.floor(Math.random() * hiddenIdx.length)];
      revealed[pick] = true;
      revealedCount++;
      updateSlotReveal();
    }

    function revealWholeWord(){
      for (let i = 0; i < revealed.length; i++) revealed[i] = true;
      revealedCount = revealed.length;
      updateSlotReveal();
    }

    function nextWord(){
      index = (index + 1) % WORDS.length;
      startRoundSmooth();
    }

    function prevWord(){
      index = (index - 1 + WORDS.length) % WORDS.length;
      startRoundSmooth();
    }

    function resetRound(){
      startRoundSmooth();
    }

    function launchConfetti(){
      confettiEl.innerHTML = "";
      const isSmall = window.matchMedia("(max-width: 520px)").matches;
      const colors = ["rgba(110,231,183,.95)","rgba(52,211,153,.95)","rgba(251,191,36,.95)","rgba(255,255,255,.9)","rgba(251,113,133,.95)"];
      const pieces = isSmall ? 34 : 60;

      for (let i = 0; i < pieces; i++){
        const p = document.createElement("div");
        p.className = "piece";
        p.style.left = (Math.random() * 100) + "vw";
        p.style.top = (-10 - Math.random() * 30) + "px";
        p.style.background = colors[(Math.random()*colors.length)|0];
        p.style.animationDelay = (Math.random() * 0.10) + "s";
        p.style.animationDuration = (0.9 + Math.random() * 0.5) + "s";
        confettiEl.appendChild(p);
      }
      setTimeout(() => { confettiEl.innerHTML = ""; }, 1200);
    }

    function checkGuess(){
      const actual = WORDS[index];
      const g = guessEl.value || "";
      if (!g.trim()) return;

      if (normalizeText(g) === normalizeText(actual)){
        revealWholeWord();
        launchConfetti();
        setMsg("CORECT!", "good");
        if (AUTO_NEXT_ON_CORRECT){
          setTimeout(() => nextWord(), 800);
        }
      } else {
        setMsg("GREȘIT!", "bad");
      }
    }

    $("btnRevealLetter").addEventListener("click", revealRandomLetter);
    $("btnRevealWord").addEventListener("click", revealWholeWord);
    $("btnNextWord").addEventListener("click", nextWord);
    $("btnPrevWord").addEventListener("click", prevWord);
    $("btnReset").addEventListener("click", resetRound);
    $("btnCheck").addEventListener("click", checkGuess);
    guessEl.addEventListener("keydown", (e) => { if (e.key === "Enter") checkGuess(); });

    // ===== background particles (very cheap on mobile) =====
    const canvas = $("fx");
    const ctx = canvas.getContext("2d", { alpha: true });

    let W = 0, H = 0;
    let last = 0;
    const FPS = 24;
    const frameMS = 1000 / FPS;

    const rand = (a,b)=> a + Math.random()*(b-a);
    const isMobile = ()=> window.matchMedia("(max-width: 520px)").matches;

    let particles = [];

    function resize(){
      W = window.innerWidth;
      H = window.innerHeight;

      // cap DPR hard for performance
      const dpr = Math.min(isMobile() ? 1.15 : 1.5, window.devicePixelRatio || 1);

      canvas.width = Math.floor(W * dpr);
      canvas.height = Math.floor(H * dpr);
      canvas.style.width = "100%";
      canvas.style.height = "100%";
      ctx.setTransform(dpr,0,0,dpr,0,0);

      initParticles();
    }

    function initParticles(){
      const mobile = isMobile();
      const count = mobile ? 18 : 40;
      particles = [];
      for (let i=0;i<count;i++){
        particles.push({
          x: rand(0,W), y: rand(0,H),
          r: rand(mobile?1.0:1.2, mobile?2.0:2.6),
          vx: rand(-0.14,0.14),
          vy: rand(-0.10,0.10),
          a: rand(0.12, 0.28)
        });
      }
    }

    function loop(ts){
      requestAnimationFrame(loop);
      if (!last) last = ts;
      if (ts - last < frameMS) return;
      last = ts;

      ctx.clearRect(0,0,W,H);

      for (const p of particles){
        p.x += p.vx; p.y += p.vy;
        if (p.x < -20) p.x = W+20;
        if (p.x > W+20) p.x = -20;
        if (p.y < -20) p.y = H+20;
        if (p.y > H+20) p.y = -20;

        ctx.beginPath();
        ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
        ctx.fillStyle = `rgba(110,231,183,${p.a})`;
        ctx.fill();
      }
    }

    window.addEventListener("resize", resize);

    resize();
    requestAnimationFrame(loop);
    startRoundCore();
  </script>
</body>
</html>
